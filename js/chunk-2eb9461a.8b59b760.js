(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2eb9461a"],{"08c1":function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return d}));var n,r,s,i=a("8785"),o=a("5184"),c=Object(o["a"])(n||(n=Object(i["a"])(["query getGuideLocal($after: String, $createdGte: DateTime, $createdLte: DateTime, $guideNumber: String, $status: String, $name: String){\n    guidesLocal(after: $after, created_Date_Gte: $createdGte, created_Date_Lte: $createdLte, guideNumber_Icontains: $guideNumber, status_Iexact: $status, name_Icontains: $name){\n        pageInfo{\n            hasNextPage\n            endCursor\n            startCursor\n        }\n        edges{\n            cursor\n            node{\n                id\n                address\n                phoneNumber\n                city\n                name\n                customerAnnotations\n                guideNumber\n                store{\n                    name\n                    email\n                    phoneNumber\n                }\n                userCreated{\n                    firstName\n                    lastName\n                }\n                status\n                created\n                guidelocalproductthroughSet{\n                    edges{\n                        node{\n                            quantity\n                            product{\n                                name\n                            }\n                            price\n                            productObservations\n                        }\n                    }\n                }\n            }\n        }\n    }\n}"]))),u=Object(o["a"])(r||(r=Object(i["a"])(["query getGuideLocal($after: String, $createdGte: DateTime, $createdLte: DateTime, $guideNumber: String, $status: String, $name: String){\n    guidesLocal(after: $after, created_Date_Gte: $createdGte, created_Date_Lte: $createdLte, guideNumber_Icontains: $guideNumber, status_Iexact: $status, name_Icontains: $name){\n        pageInfo{\n            hasNextPage\n        }\n        edges{\n            cursor\n            node{\n                guideNumber\n                guidelocalproductthroughSet{\n                    edges{\n                        node{\n                            quantity\n                            product{\n                                name\n                                sku\n                                id\n                            }\n                            price\n                            productObservations\n                        }\n                    }\n                }\n            }\n        }\n    }\n}"]))),d=Object(o["a"])(s||(s=Object(i["a"])(["query getGuideLocal($createdGte: DateTime, $createdLte: DateTime, $guideNumber: String,\n    $status: String, $name: String){\n        guidesLocalDispatch(created_Date_Gte: $createdGte, created_Date_Lte: $createdLte, status_Iexact: $status, guideNumber_Icontains: $guideNumber, name_Icontains: $name){\n              pageInfo{\n                hasNextPage\n                endCursor\n                startCursor\n            }\n            edges{\n                cursor\n                node{\n                    id\n                    address\n                    city\n                    name\n                    customerAnnotations\n                    guideNumber\n                    phoneNumber\n                    store{\n                        name\n                        email\n                        phoneNumber\n                    }\n                    userCreated{\n                        firstName\n                        lastName\n                    }\n                    status\n                    created\n                    guidelocalproductthroughSet{\n                        edges{\n                            node{\n                                quantity\n                                product{\n                                    name\n                                    sku\n                                }\n                                price\n                                productObservations\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }"])))},"156d":function(e,t,a){},"3f14":function(e,t,a){"use strict";a.r(t);a("b0c0");var n=function(){var e=this,t=e._self._c;return t("layout",[t("page-header",{attrs:{title:e.title}}),t("b-alert",{attrs:{show:""}},[e._v("La generación del documento con múltiples guías cambiará el estado a "),t("strong",[e._v("Impreso")]),e._v(", verifique antes de generarla.")]),t("b-card",[t("b-card-text",[t("b-row",[t("b-col",{attrs:{md:"4"}},[t("b-form-group",{staticClass:"mb-2"},[t("b-form-datepicker",{attrs:{placeholder:"Fecha Inicial",max:e.maxDate},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1)],1),t("b-col",{attrs:{md:"4"}},[t("b-form-group",{staticClass:"mb-2"},[t("b-form-datepicker",{attrs:{placeholder:"Fecha Final",max:e.maxDate,min:e.minEndDate},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1)],1),t("b-col",{attrs:{md:"1"}},[t("b-button",{attrs:{disabled:null===e.startDate||null===e.endDate,variant:"success"},on:{click:function(t){return e.getGuidesLocal(!0)}}},[e._v(" Enviar ")])],1),t("b-col",{attrs:{md:"1"}},[t("b-button",{directives:[{name:"show",rawName:"v-show",value:e.startDate&&e.endDate,expression:"startDate && endDate"}],attrs:{variant:"info"},on:{click:function(t){return e.clearDates()}}},[e._v(" Limpiar ")])],1)],1),t("b-row",[t("b-col",{attrs:{lg:"4",md:"4"}},[t("b-form",{staticClass:"mb-3",on:{submit:function(e){e.preventDefault()}}},[t("b-form-group",[t("b-input-group",[t("b-form-input",{attrs:{id:"input-1",type:"text",placeholder:"Buscar por número de guía",required:""},model:{value:e.searchGuide,callback:function(t){e.searchGuide=t},expression:"searchGuide"}}),t("b-input-group-append",[t("b-button",{attrs:{type:"submit",disabled:!e.searchGuide,variant:"warning"},on:{click:function(t){return e.getGuidesLocal(!0)}}},[e._v("Buscar")])],1)],1)],1)],1)],1),t("b-col",{attrs:{md:"2","offset-md":"6"}},[e.guidesSelectToPrint.length?t("guide",{attrs:{guides:e.formatDataToPrint()},on:{success:e.clearData}}):e._e()],1)],1),e.loadingGuides?[t("b-skeleton-table",{attrs:{rows:10,columns:6,"table-props":{bordered:!0,striped:!0}}})]:[e.lengthSelectGuides?[t("div",{staticClass:"table-responsive"},[t("b-table",{ref:"selectableTable",attrs:{striped:"",hover:"",items:e.guidesTable,fields:e.fields,responsive:"sm",selectable:"","select-mode":"multi"},on:{"row-selected":e.onRowSelected},scopedSlots:e._u([{key:"cell(status)",fn:function(t){var a=t.item;return[e._v(" "+e._s(e.getStatusGuideLocal(a.status))+" ")]}},{key:"cell(actions)",fn:function(a){var n=a.item;return[t("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-lg",modifiers:{"modal-lg":!0}}],attrs:{variant:"primary",size:"sm"},on:{click:function(t){return e.searchGuideLocal(n.guideNumber)}}},[t("i",{staticClass:"mdi mdi-eye"})])]}},{key:"cell(selected)",fn:function(a){var n=a.rowSelected;return[n?[t("span",{attrs:{"aria-hidden":"true"}},[e._v("✓")]),t("span",{staticClass:"sr-only"},[e._v("Selected")])]:[t("span",{attrs:{"aria-hidden":"true"}},[e._v(" ")]),t("span",{staticClass:"sr-only"},[e._v("Not selected")])]]}}],null,!1,3806408745)})],1)]:[t("div",{staticClass:"text-center"},[t("img",{staticClass:"img-fluid",attrs:{src:a("4c60"),alt:"...",width:"300px"}}),t("p",[e._v("Has superado el limite de guías, procede a imprimir las que se encuentran seleccionadas.")])])]]],2),e.hasNextPage&&e.lengthSelectGuides?t("div",{staticClass:"text-center mt-2"},[t("b-button",{attrs:{block:"",variant:"primary",disabled:e.loadingMore},on:{click:function(t){return e.getGuidesLocal()}}},[e.loadingMore?[t("b-spinner",{attrs:{small:"",type:"grow"}}),e._v(" Cargando... ")]:[e._v(" Ver más ")]],2)],1):e._e()],1),e.guideLocalSelect?t("b-modal",{attrs:{id:"modal-lg",size:"lg",title:"Guía Número ".concat(e.guideLocalSelect.guideNumber),"no-close-on-backdrop":!0,"no-close-on-esc":!0,"ok-only":""}},[t("p",{staticClass:"text_right"},[e._v(e._s(e.guideLocalSelect.created))]),t("div",{staticClass:"text-center"},[t("barcode",{attrs:{value:e.guideLocalSelect.guideNumber,"display-value":!1,format:"",width:"1",height:"60"}})],1),t("b-row",e._l(e.guideLocalSelect.products,(function(a,n){return t("div",{key:n,staticClass:"col-md-6"},[t("b-card",[t("b-card-text",[t("strong",[e._v(e._s(a.node.product.name)+":")]),e._v(" "+e._s(a.node.quantity)+" uds. ($"+e._s(e.formatPriceString(a.node.price))+") "),t("p",{staticStyle:{"font-size":"x-small"}},[e._v(" "+e._s(a.node.productObservations)+" ")])])],1)],1)})),0)],1):e._e()],1)},r=[],s=a("b85c"),i=a("c7eb"),o=a("6b75");function c(e){if(Array.isArray(e))return Object(o["a"])(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function u(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var d=a("06c5");a("d9e2");function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e){return c(e)||u(e)||Object(d["a"])(e)||l()}var b=a("1da1"),g=(a("99af"),a("c740"),a("d81d"),a("7db0"),a("444f")),p=a("2579"),f=a("08c1"),h=a("9b8d"),v=a("154f"),_=a("f579"),y=a.n(_),D=a("81ed"),C={name:"MasivePrint",components:{PageHeader:p["a"],Layout:g["a"],barcode:y.a,Guide:D["a"]},data:function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return{title:"Impresión masiva guías locales",loadingGuides:!0,hasNextPage:!1,loadingMore:!1,fields:[{key:"selected",label:"✅"},{key:"guideNumber",label:"Guía"},{key:"status",label:"Estado"},{key:"store",label:"Tienda"},{key:"products",label:"Productos"},{key:"user",label:"Usuario"},{key:"created",label:"Fecha creación"},{key:"actions",label:"Acciones"}],guidesTable:[],guidesDetail:[],guideLocalSelect:null,endCursor:null,searchGuide:null,startDate:null,endDate:null,maxDate:t,minEndDate:null,dataApi:[],guidesSelectToPrint:[],guides:[],copyGuidesSelected:[],limitGuidesToPrint:50}},watch:{searchGuide:function(e){""===e&&(this.guidesTable=[],this.endCursor=null,this.getGuidesLocal(),this.loadingGuides=!0)},startDate:function(e){this.startDate>this.endDate&&(this.endDate=this.startDate);var t=new Date(this.startDate),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);this.minEndDate=a}},methods:{getGuidesLocal:function(){var e=arguments,t=this;return Object(b["a"])(Object(i["a"])().mark((function a(){var n,r,s,o;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],t.copyGuidesSelected=[].concat(m(t.copyGuidesSelected),m(t.guidesSelectToPrint)),!0===n&&(t.loadingGuides=!0,t.guidesTable=[],t.endCursor=null),t.loadingMore=!0,a.prev=4,a.next=7,t.$apollo.query({query:f["b"],variables:{after:t.endCursor,guideNumber:t.searchGuide,status:"CRE",createdGte:null!==t.startDate?new Date(t.startDate):null,createdLte:null!==t.endDate?new Date(t.endDate):null}});case 7:if(r=a.sent,s=r.data.guidesLocal,null!==s){a.next=13;break}return t.loadingGuides=!1,t.loadingMore=!1,a.abrupt("return",Object(h["b"])("error","No se pudo recuperar la información"));case 13:return o=s.edges,t.hasNextPage=s.pageInfo.hasNextPage,t.endCursor=s.pageInfo.endCursor,t.formatDataTable(o),t.dataApi=[].concat(m(t.dataApi),m(o)),t.loadingGuides=!1,t.loadingMore=!1,t.selectRowTable(),a.abrupt("return",!0);case 24:return a.prev=24,a.t0=a["catch"](4),t.loadingGuides=!1,t.loadingMore=!1,a.abrupt("return",Object(h["b"])("error","Error al recuperar la información"));case 29:case"end":return a.stop()}}),a,null,[[4,24]])})))()},formatDataTable:function(e){var t,a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value,r={guideNumber:n.node.guideNumber,store:n.node.store.name,status:n.node.status,products:this.sumQuantityProducts(n.node.guidelocalproductthroughSet.edges),user:"".concat(n.node.userCreated.firstName," ").concat(n.node.userCreated.lastName),created:Object(v["e"])(n.node.created,!0)},i={guideNumber:n.node.guideNumber,products:n.node.guidelocalproductthroughSet.edges,created:Object(v["d"])(n.node.created,!0)};this.guidesTable.push(r),this.guidesDetail.push(i)}}catch(o){a.e(o)}finally{a.f()}},sumQuantityProducts:function(e){var t,a=0,n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;a+=r.node.quantity}}catch(i){n.e(i)}finally{n.f()}return a},searchGuideLocal:function(e){var t=this.guidesDetail.findIndex((function(t){return t.guideNumber===e}));-1!==t&&(this.guideLocalSelect=this.guidesDetail[t])},formatPriceString:function(e){return Object(v["g"])(e)},clearDates:function(){this.startDate=null,this.endDate=null,this.guidesTable=[],this.endCursor=null,this.hasNextPage=null,this.loadingGuides=!0,this.getGuidesLocal()},getStatusGuideLocal:function(e){var t={ENT:"Entregado",CAN:"Cancelado",CRE:"Creado",DES:"En despacho",ANU:"Anulado"};return t[e]},onRowSelected:function(e){var t=this;this.guidesSelectToPrint=m(e.map((function(e){var a=t.guidesTable.findIndex((function(t){return t.guideNumber===e.guideNumber}));return{guideNumber:e.guideNumber,index:a}})))},formatDataToPrint:function(){var e,t=this,a=[],n=function(e){var t,a=[],n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i={name:r.node.product.name,price:r.node.price,quantity:r.node.quantity,productObservations:r.node.productObservations};a.push(i)}}catch(o){n.e(o)}finally{n.f()}return a},r=Object(s["a"])(this.guidesSelectToPrint);try{var i=function(){var r=e.value,s=t.dataApi.find((function(e){return e.node.guideNumber===r.guideNumber})),i={guideNumber:s.node.guideNumber,destinatario:{name:s.node.name,phoneNumber:s.node.phoneNumber,address:s.node.address,city:s.node.city,customerAnnotations:s.node.customerAnnotations},remitente:{name:s.node.store.name,phoneNumber:s.node.store.phoneNumber,email:s.node.store.email},description:n(s.node.guidelocalproductthroughSet.edges)};a.push(i)};for(r.s();!(e=r.n()).done;)i()}catch(o){r.e(o)}finally{r.f()}return a},selectRowTable:function(){var e,t=this,a=Object(s["a"])(this.copyGuidesSelected);try{var n=function(){var a=e.value;t.$nextTick((function(){var e=t.$refs.selectableTable;e.selectRow(a.index)}))};for(a.s();!(e=a.n()).done;)n()}catch(r){a.e(r)}finally{a.f()}},clearData:function(){this.guidesSelectToPrint=[],this.copyGuidesSelected=[],this.guidesTable=[],this.guides=[],this.dataApi=[],this.endCursor=null,this.loadingGuides=!0,this.getGuidesLocal()}},computed:{lengthSelectGuides:function(){return this.guidesSelectToPrint.length<this.limitGuidesToPrint}},beforeMount:function(){this.getGuidesLocal()}},N=C,x=(a("e7e2"),a("2877")),G=Object(x["a"])(N,n,r,!1,null,"3414b81e",null);t["default"]=G.exports},"4c60":function(e,t,a){e.exports=a.p+"img/print.53fbe84a.png"},"81ed":function(e,t,a){"use strict";a("b0c0"),a("a4d3"),a("e01a");var n=function(){var e=this,t=e._self._c;return t("div",[t("vue-html2pdf",{ref:"html2Pdf",attrs:{"show-layout":!1,"enable-download":!0,"preview-modal":!1,"pdf-quality":2,"manual-pagination":!0,"pdf-format":"a6","pdf-orientation":"portrait","pdf-content-width":"800px"},on:{progress:function(t){return e.onProgress(t)},hasDownloaded:function(t){return e.hasDownloaded(t)}}},[t("section",{attrs:{slot:"pdf-content"},slot:"pdf-content"},e._l(e.guides,(function(n,r){return t("div",{key:r,staticClass:"page-width"},[t("section",{staticClass:"header",attrs:{id:"header"}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-6"},[t("img",{staticClass:"logo",attrs:{src:a("b260"),alt:"..."}})]),t("div",{staticClass:"col-md-6"},[t("barcode",{attrs:{value:n.guideNumber,"display-value":!1,format:"",width:"1",height:"45"}})],1)])]),t("div",{staticClass:"divider"}),t("section",{attrs:{id:"number-guide"}},[t("h4",{staticClass:"text-center text-bold"},[e._v(e._s(n.guideNumber))])]),t("div",{staticClass:"divider"}),t("section",{attrs:{id:"remitente"}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-6"},[t("h6",{staticClass:"text-bold"},[e._v("Remitente:")]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(e._s(n.remitente.name))]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(e._s(n.remitente.email))]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(" "+e._s(n.remitente.phoneNumber)+" ")])])])]),t("div",{staticClass:"divider"}),t("section",{attrs:{id:"destinatario"}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-12"},[t("h6",{staticClass:"text-bold"},[e._v("Destinatario:")]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(" "+e._s(n.destinatario.name)+" ")]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(" "+e._s(n.destinatario.phoneNumber)+" ")]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(" "+e._s(n.destinatario.address)+" ")]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(" "+e._s(n.destinatario.city)+" ")]),t("p",{staticClass:"m-0 p-0 small-text"},[e._v(" "+e._s(n.destinatario.customerAnnotations)+" ")])])])]),t("div",{staticClass:"divider"}),t("section",{attrs:{id:"description"}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-12"},[t("h6",{staticClass:"m-0"},[e._v("Descripción:")]),t("p",{staticClass:"p-0 m-0 small-text"},[e._v(e._s(e.textDescription(n.description)))])])])]),t("section",{attrs:{id:"total"}},[t("h4",{staticClass:"text-bold text-center total"},[e._v(" Valor a cobrar "+e._s(e.calculateTotalGuide(n.description))+" ")])]),e.guides.length>1?t("div",{staticClass:"html2pdf__page-break"}):e._e()])})),0)]),t("div",{staticClass:"text-center"},[t("button",{staticClass:"btn btn-success",attrs:{disabled:e.creating},on:{click:e.generateReport}},[e.creating?[t("b-spinner",{attrs:{small:""}}),e._v(" Cargando... ")]:[e._v("Generar PDF")]],2)])],1)},r=[],s=a("b85c"),i=a("c7eb"),o=a("1da1"),c=(a("99af"),a("6480")),u=a("f579"),d=a.n(u),l=a("154f"),m=a("8036"),b=a("9b8d"),g={name:"Guide",props:{guides:{type:Array,default:[]}},components:{VueHtml2pdf:c["a"],barcode:d.a},data:function(){return{creating:!1}},methods:{generateReport:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.creating=!0,t.next=3,e.markPrintedGuides();case 3:if(a=t.sent,a){t.next=6;break}return t.abrupt("return",Object(b["b"])("error"));case 6:e.$refs.html2Pdf.generatePdf();case 7:case"end":return t.stop()}}),t)})))()},onProgress:function(e){100===e&&(this.creating=!1)},calculateTotalGuide:function(e){var t,a=0,n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;a+=parseInt(r.price)}}catch(i){n.e(i)}finally{n.f()}return Object(l["g"])(a,"currency")},textDescription:function(e){var t,a="",n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;a+="".concat(r.name," X ").concat(r.quantity," ").concat(r.productObservations?r.productObservations:"").concat(e.length>1?";":""," ")}}catch(i){n.e(i)}finally{n.f()}return a},markPrintedGuides:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$apollo.mutate({mutation:m["c"],variables:{guides:e.getArrayGuides()}});case 3:if(a=t.sent,n=a.data.markPrintedGuide,null!==n){t.next=8;break}return Object(b["b"])("error","No se pudo actualizar el estado de las guías"),t.abrupt("return",!1);case 8:if(!1!==n.success){t.next=11;break}return Object(b["b"])("error","No se pudo actualizar el estado de las guías"),t.abrupt("return",!1);case 11:return t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t["catch"](0),Object(b["b"])("error","No se pudo actualizar el estado de las guías"),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,null,[[0,14]])})))()},getArrayGuides:function(){var e,t=[],a=Object(s["a"])(this.guides);try{for(a.s();!(e=a.n()).done;){var n=e.value;t.push(n.guideNumber)}}catch(r){a.e(r)}finally{a.f()}return t},hasDownloaded:function(e){this.$emit("success",!0)}}},p=g,f=(a("cbca"),a("2877")),h=Object(f["a"])(p,n,r,!1,null,"b421b45a",null);t["a"]=h.exports},"932a":function(e,t,a){},cbca:function(e,t,a){"use strict";a("932a")},e7e2:function(e,t,a){"use strict";a("156d")}}]);
//# sourceMappingURL=chunk-2eb9461a.8b59b760.js.map