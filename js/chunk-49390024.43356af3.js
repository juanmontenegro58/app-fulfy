(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49390024"],{"083a":function(e,t,a){"use strict";var n=a("0d51"),r=TypeError;e.exports=function(e,t){if(!delete e[t])throw r("Cannot delete property "+n(t)+" of "+n(e))}},"08c1":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return d}));var n,r,c,s=a("8785"),u=a("5184"),o=Object(u["a"])(n||(n=Object(s["a"])(["query getGuideLocal($after: String, $createdGte: DateTime, $createdLte: DateTime, $guideNumber: String, $status: String, $name: String){\n    guidesLocal(after: $after, created_Date_Gte: $createdGte, created_Date_Lte: $createdLte, guideNumber_Icontains: $guideNumber, status_Iexact: $status, name_Icontains: $name){\n        pageInfo{\n            hasNextPage\n            endCursor\n            startCursor\n        }\n        edges{\n            cursor\n            node{\n                id\n                address\n                phoneNumber\n                city\n                name\n                customerAnnotations\n                guideNumber\n                store{\n                    name\n                    email\n                    phoneNumber\n                }\n                userCreated{\n                    firstName\n                    lastName\n                }\n                status\n                created\n                guidelocalproductthroughSet{\n                    edges{\n                        node{\n                            quantity\n                            product{\n                                name\n                            }\n                            price\n                            productObservations\n                        }\n                    }\n                }\n            }\n        }\n    }\n}"]))),i=Object(u["a"])(r||(r=Object(s["a"])(["query getGuideLocal($after: String, $createdGte: DateTime, $createdLte: DateTime, $guideNumber: String, $status: String, $name: String){\n    guidesLocal(after: $after, created_Date_Gte: $createdGte, created_Date_Lte: $createdLte, guideNumber_Icontains: $guideNumber, status_Iexact: $status, name_Icontains: $name){\n        pageInfo{\n            hasNextPage\n        }\n        edges{\n            cursor\n            node{\n                guideNumber\n                guidelocalproductthroughSet{\n                    edges{\n                        node{\n                            quantity\n                            product{\n                                name\n                                sku\n                                id\n                            }\n                            price\n                            productObservations\n                        }\n                    }\n                }\n            }\n        }\n    }\n}"]))),d=Object(u["a"])(c||(c=Object(s["a"])(["query getGuideLocal($createdGte: DateTime, $createdLte: DateTime, $guideNumber: String,\n    $status: String, $name: String){\n        guidesLocalDispatch(created_Date_Gte: $createdGte, created_Date_Lte: $createdLte, status_Iexact: $status, guideNumber_Icontains: $guideNumber, name_Icontains: $name){\n              pageInfo{\n                hasNextPage\n                endCursor\n                startCursor\n            }\n            edges{\n                cursor\n                node{\n                    id\n                    address\n                    city\n                    name\n                    customerAnnotations\n                    guideNumber\n                    phoneNumber\n                    store{\n                        name\n                        email\n                        phoneNumber\n                    }\n                    userCreated{\n                        firstName\n                        lastName\n                    }\n                    status\n                    created\n                    guidelocalproductthroughSet{\n                        edges{\n                            node{\n                                quantity\n                                product{\n                                    name\n                                    sku\n                                }\n                                price\n                                productObservations\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }"])))},1228:function(e,t,a){"use strict";a.r(t);a("99af"),a("fb6a");var n,r=function(){var e=this,t=e._self._c;return t("layout",[t("page-header",{attrs:{title:e.title}}),t("div",[t("b-card",{staticClass:"mb-2 text-center",attrs:{title:"Egreso de inventario"}},[t("b-card-text",[e.loadingProducts?[t("b-skeleton",{attrs:{animation:"wave",width:"85%"}}),t("b-skeleton",{attrs:{animation:"wave",width:"55%"}}),t("b-skeleton",{attrs:{animation:"wave",width:"70%"}}),t("b-skeleton",{attrs:{animation:"wave",width:"55%"}}),t("b-skeleton",{attrs:{animation:"wave",width:"85%"}})]:[t("div",{staticClass:"d-grid gap-2 d-md-flex justify-content-md-end"},[t("div",{staticClass:"form-check form-switch form-switch-md mb-3 form-check-reverse"},[t("label",{staticClass:"form-check-label custom-label",attrs:{for:"flexSwitchCheckDefault"}},[e._v(" Única unidad ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.uniqueProduct,expression:"uniqueProduct"}],staticClass:"form-check-input",attrs:{type:"checkbox",role:"switch",id:"flexSwitchCheckDefault",disabled:e.checkGuideLocal},domProps:{checked:Array.isArray(e.uniqueProduct)?e._i(e.uniqueProduct,null)>-1:e.uniqueProduct},on:{change:function(t){var a=e.uniqueProduct,n=t.target,r=!!n.checked;if(Array.isArray(a)){var c=null,s=e._i(a,c);n.checked?s<0&&(e.uniqueProduct=a.concat([c])):s>-1&&(e.uniqueProduct=a.slice(0,s).concat(a.slice(s+1)))}else e.uniqueProduct=r}}})])]),t("div",{staticClass:"d-grid gap-2 d-md-flex justify-content-md-end"},[t("div",{staticClass:"form-check form-switch form-switch-md mb-3 form-check-reverse"},[t("label",{staticClass:"form-check-label custom-label",attrs:{for:"flexSwitchCheckDefault"}},[e._v(" Guía local ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.checkGuideLocal,expression:"checkGuideLocal"}],staticClass:"form-check-input",attrs:{type:"checkbox",role:"switch",id:"flexSwitchCheckDefault",disabled:e.uniqueProduct},domProps:{checked:Array.isArray(e.checkGuideLocal)?e._i(e.checkGuideLocal,null)>-1:e.checkGuideLocal},on:{change:function(t){var a=e.checkGuideLocal,n=t.target,r=!!n.checked;if(Array.isArray(a)){var c=null,s=e._i(a,c);n.checked?s<0&&(e.checkGuideLocal=a.concat([c])):s>-1&&(e.checkGuideLocal=a.slice(0,s).concat(a.slice(s+1)))}else e.checkGuideLocal=r}}})])]),t("b-form-group",{directives:[{name:"show",rawName:"v-show",value:e.auxShowItems,expression:"auxShowItems"}],staticClass:"mb-2"},[t("b-input-group",[t("b-form-input",{ref:"inputSku",attrs:{id:"input-1",type:"text",placeholder:"SKU",required:"",autofocus:""},on:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.searchSku&&e.addProduct()}},model:{value:e.searchSku,callback:function(t){e.searchSku=t},expression:"searchSku"}})],1)],1),t("b-form-group",[t("b-input-group",[t("b-form-input",{ref:"inputGuide",attrs:{id:"input-1",type:"text",placeholder:"Ingrese o escanee el número de la guia",required:""},on:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.packageGuide&&e.createExpenseAux()}},model:{value:e.packageGuide,callback:function(t){e.packageGuide=t},expression:"packageGuide"}})],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.productSelected.length,expression:"productSelected.length"}]},[t("b-table",{attrs:{striped:"",hover:"",items:e.productSelected,fields:e.fields},scopedSlots:e._u([e.checkGuideLocal?null:{key:"cell(actions)",fn:function(a){var n=a.item;return[t("b-btn",{attrs:{variant:"danger"},on:{click:function(t){return e.deleteRecord(n.sku)}}},[t("i",{staticClass:"mdi mdi-delete"})])]}}],null,!0)})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.productSelected.length,expression:"!productSelected.length"}],staticClass:"mt-2"},[t("img",{staticClass:"img-fluid",attrs:{src:a("48b6"),alt:"...",width:"300px"}})])]],2)],1),t("b-card",{staticClass:"text-center",attrs:{title:"Últimos despachos"}},[t("b-card-text",[e.loadingDispatchs?[t("b-skeleton-table",{attrs:{rows:4,columns:4,"table-props":{bordered:!0,striped:!0}}})]:[t("b-table",{attrs:{striped:"",hover:"",items:e.lastDispatchs,fields:e.fieldsDispatch}})]],2)],1)],1)],1)},c=[],s=a("b85c"),u=a("c7eb"),o=a("1da1"),i=a("5530"),d=(a("b0c0"),a("c740"),a("ac1f"),a("1276"),a("a434"),a("13d5"),a("d3b7"),a("444f")),l=a("2579"),p=a("3d20"),h=a.n(p),f=a("9b8d"),b=a("154f"),m=a("8fbd"),g=a("8785"),k=a("5184"),v=Object(k["a"])(n||(n=Object(g["a"])(["mutation createExpense($expense: [ExpenseInput]!, $packageGuide: String!){\n    createExpense(expense: $expense, packageGuide: $packageGuide){\n        expense\n    }\n}"]))),x=a("9323"),y=a("08c1"),$=a("4d77"),S={name:"ExpenseInventory",components:{Layout:d["a"],PageHeader:l["a"]},data:function(){return{title:"Inventario",loadingProducts:!0,loadingDispatchs:!0,lastDispatchs:[],searchSku:null,packageGuide:null,lastCursor:null,fieldsDispatch:[{key:"guide",label:"Guía"},{key:"store",label:"Tienda"},{key:"products",label:"Productos"},{key:"created",label:"Fecha despacho"}],fields:[{key:"name",label:"Producto"},{key:"quantity",label:"Cantidad"},{key:"actions",label:"Acciones"}],allProducts:[],productSelected:[],loadingCreate:!1,submitCreate:!1,uniqueProduct:!1,checkGuideLocal:!1}},watch:{uniqueProduct:function(e){this.$refs.inputSku.focus()},checkGuideLocal:function(e){var t=this;this.productSelected=[],this.packageGuide=null,!0===e?this.$refs.inputGuide.focus():this.$nextTick((function(){t.$refs.inputSku.focus()}))}},computed:Object(i["a"])(Object(i["a"])({},$["i"]),{},{auxShowItems:function(){return!1===this.uniqueProduct&&!1===this.checkGuideLocal||(!0===this.uniqueProduct&&!1===this.checkGuideLocal||(!1===this.uniqueProduct&&this.checkGuideLocal,!1))}}),methods:{getProducts:function(){var e=this;return Object(o["a"])(Object(u["a"])().mark((function t(){var a,n,r;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$apollo.query({query:m["a"],variables:{cursor:e.lastCursor}});case 3:a=t.sent,n=a.data.listProducts,null!==n?(r=n.edges,e.hasNextPage=n.pageInfo.hasNextPage,e.addArrayProducts(r),e.hasNextPage?e.getProducts():e.loadingProducts=!1):(Object(f["b"])("error","No se pudo recuperar la información"),e.loadingProducts=!1),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),e.loadingProducts=!1,Object(f["b"])("error","No se pudo recuperar la información");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getDispatchs:function(){var e=this;return Object(o["a"])(Object(u["a"])().mark((function t(){var a,n,r;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$apollo.query({query:x["b"],variables:{includeStore:!0,includeSku:!1,first:4}});case 3:a=t.sent,n=a.data.dispatchs,null!==n?(r=n.edges,e.hasNextPage=n.pageInfo.hasNextPage,e.formatTableLastDispatch(r)):Object(f["b"])("error","No se pudo recuperar la información de los ultimos despachos"),e.loadingDispatchs=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](0),e.loadingDispatchs=!1,Object(f["b"])("error","No se pudo recuperar la información de los ultimos despachos");case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},addArrayProducts:function(e){var t,a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=n.node,c={id:r.id,name:r.name,price:r.price,stock:r.stock,sku:r.sku};this.allProducts.push(c),this.lastCursor=n.cursor}}catch(u){a.e(u)}finally{a.f()}},addProduct:function(){var e=this,t=this.allProducts.findIndex((function(t){return t.sku===e.searchSku}));if(-1===t)Object(f["b"])("error","El producto no se ha encontrado");else{!0===this.uniqueProduct&&this.$refs.inputGuide.focus();var a=this.productSelected.findIndex((function(t){return t.sku===e.searchSku}));if(-1!==a){var n=this.productSelected[a];n.quantity+=1}else this.productSelected.push(this.formatDataTable(this.allProducts[t]))}this.searchSku=null},formatDataTable:function(e){var t=Object(b["a"])(e.id).split(":")[1],a={name:e.name,quantity:1,sku:e.sku,id:t};return a},formatDataMutation:function(e){var t,a=[],n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,c={quantity:r.quantity,product:r.id};a.push(c)}}catch(u){n.e(u)}finally{n.f()}return a},createExpense:function(){var e=this;return Object(o["a"])(Object(u["a"])().mark((function t(){var a,n,r,c;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingCreate=!0,e.submitCreate=!0,a=e.formatDataMutation(e.productSelected),t.prev=3,t.next=6,e.$apollo.mutate({mutation:v,variables:{expense:a,packageGuide:e.packageGuide}});case 6:n=t.sent,r=n.data.createExpense,null!==r?(c=r.expense,!0===c?(e.addNewExpenseToLastDispatchs(),e.productSelected=[],e.packageGuide=null,!0===e.checkGuideLocal?e.$refs.inputGuide.focus():e.$refs.inputSku.focus(),Object(f["b"])("success","El egreso se realizo correctamente")):Object(f["b"])("error","El egreso no se pudo realizar")):Object(f["b"])("error","El egreso no se pudo realizar"),e.loadingCreate=!1,e.submitCreate=!1,t.next=18;break;case 13:t.prev=13,t.t0=t["catch"](3),e.loadingCreate=!1,e.submitCreate=!1,Object(f["b"])("error","El egreso no se pudo realizar");case 18:case"end":return t.stop()}}),t,null,[[3,13]])})))()},createExpenseAux:function(){var e=this;return Object(o["a"])(Object(u["a"])().mark((function t(){var a;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!0!==e.checkGuideLocal){t.next=3;break}return t.next=3,e.getGuideLocal();case 3:if(0!==e.productSelected.length){t.next=5;break}return t.abrupt("return",Object(f["b"])("error","No hay productos seleccionados para la guía ".concat(e.packageGuide)));case 5:a="<p> Estas seguro de guardar el egreso con número de guía <strong>".concat(e.packageGuide,"</strong></p> "),h.a.fire({title:"¿Estas seguro?",html:a,icon:"question",showCancelButton:!0,cancelButtonText:"No, cancelar",cancelButtonColor:"#bb2d3b",confirmButtonText:"Si, guardar",showLoaderOnConfirm:!0,preConfirm:function(){return e.createExpense()}});case 7:case"end":return t.stop()}}),t)})))()},deleteRecord:function(e){var t=this.productSelected.findIndex((function(t){return t.sku===e}));-1!==t&&this.productSelected.splice(t,1)},formatTableLastDispatch:function(e){var t,a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value,r={guide:n.node.guide,store:n.node.store.name,created:Object(b["d"])(n.node.created),products:this.sumQuantityProducts(n.node.productpackagethroughSet)};this.lastDispatchs.push(r)}}catch(c){a.e(c)}finally{a.f()}},sumQuantityProducts:function(e){var t,a=0,n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;a+=r.quantity}}catch(c){n.e(c)}finally{n.f()}return a},addNewExpenseToLastDispatchs:function(){var e=this;return Object(o["a"])(Object(u["a"])().mark((function t(){var a;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.lastDispatchs.pop(),a={guide:e.packageGuide,store:e.currentStoreUser,created:Object(b["d"])(new Date),products:e.productSelected.reduce((function(e,t){return e+(t.quantity||0)}),0)},e.lastDispatchs.unshift(a);case 3:case"end":return t.stop()}}),t)})))()},getGuideLocal:function(){var e=this;return Object(o["a"])(Object(u["a"])().mark((function t(){var a,n,r;return Object(u["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$apollo.query({query:y["a"],variables:{guideNumber:e.packageGuide}});case 3:if(a=t.sent,n=a.data.guidesLocal,null!==n){t.next=7;break}return t.abrupt("return",Object(f["b"])("error","No se pudo recuperar la información"));case 7:return r=n.edges[0].node.guidelocalproductthroughSet.edges,e.productSelected=e.formatDataGuideLocalToAddTable(r),t.abrupt("return",!0);case 12:return t.prev=12,t.t0=t["catch"](0),console.log(t.t0),t.abrupt("return",Object(f["b"])("error","Error al recuperar la información"));case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()},formatDataGuideLocalToAddTable:function(e){var t,a=[],n=Object(s["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,c={name:r.node.product.name,quantity:r.node.quantity,sku:r.node.product.sku,id:Object(b["a"])(r.node.product.id).split(":")[1]};a.push(c)}}catch(u){n.e(u)}finally{n.f()}return a}},beforeMount:function(){this.getProducts(),this.getDispatchs()}},w=S,O=(a("ec1d"),a("2877")),j=Object(O["a"])(w,r,c,!1,null,"3c5e69e3",null);t["default"]=j.exports},"48b6":function(e,t,a){e.exports=a.p+"img/barcode.0152e02c.png"},"790f":function(e,t,a){},"8fbd":function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return o}));var n,r,c=a("8785"),s=a("5184"),u=Object(s["a"])(n||(n=Object(c["a"])(["query listProducts($cursor: String, $productName: String){\n    listProducts(after: $cursor, name_Icontains: $productName){\n        pageInfo{\n            hasNextPage\n        }\n        edges{\n            cursor\n            node{\n                name\n                id\n                stock\n                price\n                sku\n                store{\n                    name\n                }\n            }\n        }\n    }\n}"]))),o=Object(s["a"])(r||(r=Object(c["a"])(["query productsLowStock($store: Int){\n    productsLowStock(store: $store){\n        stock\n        product\n        store\n        id\n    }\n}"])))},9323:function(e,t,a){"use strict";a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return o}));var n,r,c=a("8785"),s=a("5184"),u=Object(s["a"])(n||(n=Object(c["a"])(["query allDispatchs($store: String, $guide: String,\n    $cursor: String, $includeStore: Boolean!, $includeSku: Boolean!, $startDate: DateTime,\n    $endDate: DateTime, $first: Int){\n    dispatchs(store_Name_Iexact: $store, guide_Icontains: $guide after: $cursor,\n        created_Date_Gte: $startDate, created_Date_Lte: $endDate, first: $first){\n        pageInfo{\n            hasNextPage\n        }\n        edges{\n            cursor\n            node{\n                guide\n                created\n                productpackagethroughSet{\n                    product{\n                        name\n                        sku @include(if: $includeSku)\n                        id\n                    }\n                    quantity\n                }\n                store @include(if: $includeStore){\n                    name\n                }\n            }\n        }\n    }\n}"]))),o=Object(s["a"])(r||(r=Object(c["a"])(["query DispatchsReturns($store: Int, $startDate: Date!, $endDate: Date!){\n    returnsDispatchs(startDate: $startDate, endDate: $endDate, store: $store){\n        dispatchs\n        returns\n        storeName\n        storeId\n    }\n}"])))},a434:function(e,t,a){"use strict";var n=a("23e7"),r=a("7b0b"),c=a("23cb"),s=a("5926"),u=a("07fa"),o=a("3511"),i=a("65f0"),d=a("8418"),l=a("083a"),p=a("1dde"),h=p("splice"),f=Math.max,b=Math.min;n({target:"Array",proto:!0,forced:!h},{splice:function(e,t){var a,n,p,h,m,g,k=r(this),v=u(k),x=c(e,v),y=arguments.length;for(0===y?a=n=0:1===y?(a=0,n=v-x):(a=y-2,n=b(f(s(t),0),v-x)),o(v+a-n),p=i(k,n),h=0;h<n;h++)m=x+h,m in k&&d(p,h,k[m]);if(p.length=n,a<n){for(h=x;h<v-n;h++)m=h+n,g=h+a,m in k?k[g]=k[m]:l(k,g);for(h=v;h>v-n+a;h--)l(k,h-1)}else if(a>n)for(h=v-n;h>x;h--)m=h+n-1,g=h+a-1,m in k?k[g]=k[m]:l(k,g);for(h=0;h<a;h++)k[h+x]=arguments[h+2];return k.length=v-n+a,p}})},ec1d:function(e,t,a){"use strict";a("790f")}}]);
//# sourceMappingURL=chunk-49390024.43356af3.js.map