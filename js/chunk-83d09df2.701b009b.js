(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-83d09df2"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"83e5":function(e,t,a){"use strict";a.r(t);a("ac1f"),a("841c"),a("b0c0");var n,r=function(){var e=this,t=e._self._c;return t("layout",[t("page-header",{attrs:{title:e.title}}),[t("div",[t("b-card",{staticClass:"mb-2"},[t("b-card-text",[t("b-row",[t("b-col",{attrs:{md:"4"}},[t("b-form-group",{staticClass:"mb-2"},[t("b-form-datepicker",{attrs:{placeholder:"Fecha Inicial",max:e.maxDate},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1)],1),t("b-col",{attrs:{md:"4"}},[t("b-form-group",{staticClass:"mb-2"},[t("b-form-datepicker",{attrs:{placeholder:"Fecha Final",max:e.maxDate,min:e.minEndDate},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1)],1),t("b-col",{attrs:{md:"1"}},[t("b-button",{attrs:{disabled:null===e.startDate||null===e.endDate,variant:"success"},on:{click:function(t){return e.getReturns(!0)}}},[e._v(" Enviar ")])],1),t("b-col",{attrs:{md:"1"}},[t("b-button",{directives:[{name:"show",rawName:"v-show",value:e.startDate&&e.endDate,expression:"startDate && endDate"}],attrs:{variant:"info"},on:{click:function(t){return e.clearDates()}}},[e._v(" Limpiar ")])],1)],1),t("b-col",{attrs:{lg:"4",md:"4"}},[t("b-form",{staticClass:"mb-3",on:{submit:function(e){e.preventDefault()}}},[t("b-form-group",[t("b-input-group",[t("b-form-input",{attrs:{id:"input-1",type:"text",placeholder:"Buscar por número de guía",required:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t("b-input-group-append",[t("b-button",{attrs:{type:"submit",disabled:!e.search,variant:"warning"},on:{click:function(t){return e.getReturns(!0)}}},[e._v("Buscar")])],1)],1)],1)],1)],1),e.loadingReturns?[t("b-skeleton-table",{attrs:{rows:10,columns:4,"table-props":{bordered:!0,striped:!0}}})]:[t("div",{staticClass:"table-responsive"},[t("b-table",{attrs:{striped:"",hover:"",items:e.returnsTable,fields:e.fields,responsive:"sm"},scopedSlots:e._u([{key:"cell(actions)",fn:function(a){var n=a.item;return[t("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-lg",modifiers:{"modal-lg":!0}}],attrs:{variant:"primary"},on:{click:function(t){return e.searchDispatch(n.guide)}}},[t("i",{staticClass:"mdi mdi-eye"})])]}}])})],1)]],2)],1),e.hasNextPage?t("div",{staticClass:"text-center mt-2"},[t("b-button",{attrs:{block:"",variant:"primary",disabled:e.loadingMore},on:{click:function(t){return e.getReturns()}}},[e.loadingMore?[t("b-spinner",{attrs:{small:"",type:"grow"}}),e._v(" Cargando... ")]:[e._v(" Ver más ")]],2)],1):e._e()],1),e.returnSelected?t("b-modal",{attrs:{id:"modal-lg",size:"lg",title:"Devolución ".concat(e.returnSelected.guide),"no-close-on-backdrop":!0,"no-close-on-esc":!0}},[t("b-row",e._l(e.returnSelected.products,(function(a,n){return t("div",{key:n,staticClass:"col-md-6"},[t("b-card",[t("b-card-text",[t("strong",[e._v(e._s(a.product.name)+":")]),e._v(" "+e._s(a.quantity)+" ")])],1)],1)})),0)],1):e._e()]],2)},s=[],u=a("b85c"),i=a("c7eb"),o=a("1da1"),l=(a("c740"),a("444f")),c=a("2579"),d=a("8785"),b=a("5184"),h=Object(b["a"])(n||(n=Object(d["a"])(["query listReturns($startDate: DateTime, $endDate: DateTime, $numberGuide: String, $cursor: String){\n    returns(guide_Icontains: $numberGuide, after: $cursor, returnedDate_Date_Gte: $startDate, returnedDate_Date_Lte: $endDate){\n        pageInfo{\n            hasNextPage\n        }\n        edges{\n            cursor\n            node{\n                guide\n                store{\n                    name\n                }\n                productpackagethroughSet{\n                    quantity\n                    product{\n                        name\n                    }\n                }\n                returnedDate\n            }\n        }\n    }\n}"]))),m=a("9b8d"),p=a("154f"),g={name:"Returns",components:{Layout:l["a"],PageHeader:c["a"]},data:function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return{title:"Devoluciones",loadingReturns:!0,loadingMore:!1,hasNextPage:null,lastCursor:null,returnsTable:[],guideNumber:null,search:null,startDate:null,endDate:null,maxDate:t,minEndDate:null,fields:[{key:"guide",label:"Guía"},{key:"store",label:"Tienda"},{key:"products",label:"Productos"},{key:"returned_date",label:"Fecha devolución"},{key:"actions",label:"Acciones"}],returnDetail:[],returnSelected:null}},watch:{search:function(e){""===e&&(this.returnsTable=[],this.lastCursor=null,this.getReturns(),this.loadingReturns=!0)},startDate:function(e){this.startDate>this.endDate&&(this.endDate=this.startDate);var t=new Date(this.startDate),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);this.minEndDate=a}},methods:{getReturns:function(){var e=arguments,t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){var n,r,s,u;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]&&e[0],!0===n&&(t.loadingReturns=!0,t.returnsTable=[],t.lastCursor=null),t.loadingMore=!0,a.prev=3,a.next=6,t.$apollo.query({query:h,variables:{cursor:t.lastCursor,numberGuide:t.search,startDate:null!==t.startDate?new Date(t.startDate):null,endDate:null!==t.endDate?new Date(t.endDate):null}});case 6:r=a.sent,s=r.data.returns,null!==s?(u=s.edges,t.hasNextPage=s.pageInfo.hasNextPage,t.formatDataTable(u)):Object(m["b"])("error","No se pudo recuperar la información"),t.loadingReturns=!1,t.loadingMore=!1,a.next=18;break;case 13:a.prev=13,a.t0=a["catch"](3),t.loadingReturns=!1,t.loadingMore=!1,Object(m["b"])("error","No se pudo recuperar la información");case 18:case"end":return a.stop()}}),a,null,[[3,13]])})))()},formatDataTable:function(e){var t,a=Object(u["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value,r={guide:n.node.guide,returned_date:Object(p["d"])(n.node.returnedDate),products:this.sumQuantityProducts(n.node.productpackagethroughSet),store:n.node.store.name},s={guide:n.node.guide,products:n.node.productpackagethroughSet};this.returnsTable.push(r),this.returnDetail.push(s),this.lastCursor=n.cursor}}catch(i){a.e(i)}finally{a.f()}},sumQuantityProducts:function(e){var t,a=0,n=Object(u["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;a+=r.quantity}}catch(s){n.e(s)}finally{n.f()}return a},searchDispatch:function(e){var t=this.returnDetail.findIndex((function(t){return t.guide===e}));-1!==t&&(this.returnSelected=this.returnDetail[t])},clearDates:function(){this.startDate=null,this.endDate=null,this.returnsTable=[],this.lastCursor=null,this.hasNextPage=null,this.loadingReturns=!0,this.getReturns()}},beforeMount:function(){this.getReturns()}},f=g,D=a("2877"),v=Object(D["a"])(f,r,s,!1,null,null,null);t["default"]=v.exports},"841c":function(e,t,a){"use strict";var n=a("c65b"),r=a("d784"),s=a("825a"),u=a("1d80"),i=a("129f"),o=a("577e"),l=a("dc4a"),c=a("14c3");r("search",(function(e,t,a){return[function(t){var a=u(this),r=void 0==t?void 0:l(t,e);return r?n(r,t,a):new RegExp(t)[e](o(a))},function(e){var n=s(this),r=o(e),u=a(t,n,r);if(u.done)return u.value;var l=n.lastIndex;i(l,0)||(n.lastIndex=0);var d=c(n,r);return i(n.lastIndex,l)||(n.lastIndex=l),null===d?-1:d.index}]}))}}]);
//# sourceMappingURL=chunk-83d09df2.701b009b.js.map